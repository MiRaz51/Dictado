<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <!-- Security and download policy -->
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta name="referrer" content="no-referrer">
  <!-- AplicaciÃ³n optimizada para escritorio -->
  <title>PrÃ¡ctica de OrtografÃ­a</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/styles/variables.css">
  <link rel="stylesheet" href="assets/styles/base.css">
  <link rel="stylesheet" href="assets/styles/utilities.css">
  <link rel="stylesheet" href="assets/styles/forms.css">
  <link rel="stylesheet" href="assets/styles.css">
  <!-- CSS modularizado: componentes -->
  <link rel="stylesheet" href="assets/styles/components/help-button.css">
  <link rel="stylesheet" href="assets/styles/components/tutorial.css">
  <link rel="stylesheet" href="assets/styles/components/config-card.css">
  <link rel="stylesheet" href="assets/styles/components/progress.css">
  <link rel="stylesheet" href="assets/styles/components/participant.css">
  <link rel="stylesheet" href="assets/styles/components/tutor.css">
  <link rel="stylesheet" href="assets/styles/components/virtual-keyboard.css">
  <link rel="stylesheet" href="assets/styles/components/reportes.css">
  <link rel="stylesheet" href="assets/styles/components/badges.css">
  <link rel="stylesheet" href="assets/styles/components/feedback.css">
  <link rel="stylesheet" href="assets/styles/components/peer.css">
  <link rel="stylesheet" href="assets/styles/components/time-credits.css">
  <!-- Responsive styles centralized -->
  <link rel="stylesheet" href="assets/styles/responsive.css">
  <!-- Simple Keyboard CSS (solo se usa en mÃ³viles/tablets) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-keyboard@latest/build/css/index.css">
  <script src="modules/word-filters-fixed.js" onload="console.log('âœ… modules/word-filters-fixed.js cargado')" onerror="console.error('âŒ Error cargando modules/word-filters-fixed.js')"></script>
  <script src="modules/filters.js" onload="console.log('âœ… modules/filters.js cargado')" onerror="console.error('âŒ Error cargando modules/filters.js')"></script>
</head>
<body>
  <!-- BotÃ³n de ayuda/tutorial (flotante, fuera del contenedor principal) -->
  <button id="help-btn" class="help-button" title="Ver ayuda de esta pÃ¡gina">
    <span>?</span>
  </button>

  <!-- Badge de crÃ©ditos (flotante, visible solo en pÃ¡ginas de participante/individual) -->
  <button id="tcBadgeBtn" class="tc-badge-floating hidden" title="Ver y canjear crÃ©ditos de tiempo" type="button">
    â± <span class="tc-mins" id="tcMins">0</span> min Â· <span id="tcUserShort">-</span>
  </button>
  <!-- Modal de CrÃ©ditos de Tiempo se carga desde templates/tplTimeCreditsModal.html -->

  <!-- Eliminado: script inline duplicado. Todas las funciones reales estÃ¡n en app.js -->
  <div class="container">
  
  <h2><span class="brand">PrÃ¡ctica</span> de OrtografÃ­a</h2>
  <p id="metaAlumnoCurso" class="meta hidden"></p>

  <!-- PÃ¡gina 0: SelecciÃ³n de Modo -->
  <section id="page-mode-select" class="page active">
    <div class="card center">
      <h3 style="margin-bottom: 20px; color: var(--text);">Selecciona el modo de prÃ¡ctica</h3>
      <div class="mode-grid">
        <div id="modeIndividual" class="mode-card" role="button" tabindex="0">
          <div class="mode-icon">ğŸ‘¤</div>
          <h4>Individual</h4>
          <p>PrÃ¡ctica personal independiente</p>
        </div>

        <div id="modeGroup" class="mode-card" role="button" tabindex="0">
          <div class="mode-icon">ğŸ‘¥</div>
          <h4>Grupal</h4>
          <p>SesiÃ³n colaborativa con tutor</p>
        </div>
      </div>
    </div>
  </section>

  <!-- PÃ¡gina 0.5: SelecciÃ³n de Rol Grupal -->
  <section id="page-role-select" class="page">
    <div class="card center">
      <h3 style="margin-bottom: 20px; color: var(--text);">Selecciona tu rol</h3>
      <div class="mode-grid">
        <div class="mode-card">
          <div class="mode-icon">ğŸ“</div>
          <h4>Tutor/Administrador</h4>
          <p>Crear y gestionar la sesiÃ³n</p>
        </div>
        <div class="mode-card">
          <div class="mode-icon">ğŸ“</div>
          <h4>Participante/Alumno</h4>
          <p>Unirse a una sesiÃ³n existente</p>
        </div>
      </div>
      <div class="actions">
        <button class="btn-ghost">â—‚ Volver</button>
      </div>
    </div>
  </section>

  <!-- PÃ¡gina 1: ConfiguraciÃ³n -->
  <section id="page-config" class="page">
    <div class="card" style="margin: 12px 0;">
      <div class="form-row">
        <div class="form-field" style="grid-column: 1 / -1;">
          <label for="alumno"><strong>Participante</strong>:</label>
          <input id="alumno" type="text" placeholder="Nombre y apellido" tabindex="1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
          <div id="alumnoError" class="help-error">Este campo es obligatorio.</div>
        </div>
        <div class="form-field" style="grid-column: 1 / -1;">
          <label for="edad"><strong>Edad</strong>:</label>
          <input id="edad" type="number" min="6" max="99" placeholder="Ingresa tu edad (mÃ­nimo 6 aÃ±os)" tabindex="2" autocomplete="off" title="La edad mÃ­nima es de 6 aÃ±os" required oninvalid="this.setCustomValidity('Por favor, ingresa una edad vÃ¡lida. La edad mÃ­nima es de 6 aÃ±os.')" oninput="this.setCustomValidity('')">
          <div class="hint" style="font-size: 0.85rem; color: #666; margin-top: 4px;">
            â„¹ï¸ La edad mÃ­nima es de <strong>6 aÃ±os</strong>.
          </div>
        </div>
      </div>
    </div>
    <div class="actions">
      <button id="btnNext" class="btn-ghost" disabled tabindex="6">Siguiente â–¸</button>
    </div>
  </section>

  <!-- PÃ¡gina 2: Ejercicio -->
  <section id="page-game" class="page">
    <div class="card" style="margin: 12px 0;">
      <div id="config-individual-block"></div>
    </div>
    
    <p>Selecciona un nivel de dificultad:</p>
    
    <div class="actions" style="display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:6px;">
      <button id="btnVolverGame" class="btn-ghost">â—‚ Volver</button>
      <button id="btnNivelBasico" class="btn-nivel" tabindex="7">ğŸŒ± Nivel BÃ¡sico</button>
      <button id="btnNivelIntermedio" class="btn-nivel" tabindex="8">ğŸŒ¿ Nivel Intermedio</button>
      <button id="btnNivelAvanzado" class="btn-nivel" tabindex="9">ğŸŒ³ Nivel Avanzado</button>
      <button id="btnNivelExperto" class="btn-nivel" tabindex="10">ğŸ”¥ Nivel Experto</button>
      <button class="btn-ghost" type="button" title="Limpiar cachÃ© del JSON y recargar">â†» Refrescar datos</button>
      <span id="nivelesDiag" class="hint hint-muted hidden"></span>
    </div>
    <div id="juego" class="card mt-14" style="display:none;">
      <div class="avance-row">
        <div class="progress" aria-label="Progreso de palabras">
          <div id="progressFill" class="progress-fill"></div>
        </div>
        <div id="progressText" class="progress-text">0/0</div>
      </div>
      <div class="row layout-game-input">
        <button id="btnSpeak">ğŸ”Š Reproducir palabra</button>
        <button id="btnEnableAudio" class="btn-ghost" style="display:none;">Permitir audio</button>
        <input type="text" id="respuesta" placeholder="Escribe aquÃ­" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" data-ms-editor="false" data-gramm="false" data-gramm_editor="false" data-enable-grammarly="false" data-gramm-mode="false" data-lt-installed="false">
        <!-- Espejo visual del input (mÃ³vil/tablet) para mostrar un caret falso en la misma posiciÃ³n -->
        <div id="vkMirror" class="vk-mirror" aria-hidden="false">
          <span class="vk-mirror-text"></span><span class="vk-caret"></span>
        </div>
        <button id="btnComprobar">Comprobar</button>
      </div>
      <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
        <p id="resultado" class="status"></p>
        <p id="marcador" class="status"></p>
      </div>
      <div class="actions mt-6">
        <button id="btnToReport" style="display:none;">Siguiente â–¸</button>
      </div>
    </div>
  </section>

  <!-- PÃ¡gina 2.4: InformaciÃ³n del Tutor (nueva) -->
  <section id="page-tutor-info" class="page">
    <div class="card">
      <h3>ğŸ“ InformaciÃ³n del Tutor</h3>
      
      <div class="form-field">
        <label for="tutorName"><strong>Tutor/Administrador:</strong></label>
        <input id="tutorName" type="text" placeholder="Ingresa tu nombre como tutor" tabindex="1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
      </div>
      
      <div class="form-field">
        <label for="tutorGroup"><strong>Grupo/Grado:</strong></label>
        <input id="tutorGroup" type="text" placeholder="Ej: 3Â° Primaria, Grupo A, etc." tabindex="2" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
      </div>
    </div>
    
    <div class="actions">
      <button class="btn-ghost">â—‚ Volver</button>
      <button id="btnTutorNext" tabindex="3">Siguiente â–¸</button>
    </div>
  </section>

  <!-- PÃ¡gina 2.5: ConfiguraciÃ³n del Tutor -->
  <section id="page-tutor-config" class="page">
    <div class="card">
      <h3>ğŸ“ ConfiguraciÃ³n del Ejercicio</h3>
      <div id="config-tutor-block"></div>
    </div>
    
    <p>Selecciona un nivel de dificultad:</p>
    
    <div class="actions">
      <button class="btn-ghost">â—‚ Volver</button>
      <button id="tutorNivelBasico" class="btn-nivel">ğŸŒ± Nivel BÃ¡sico</button>
      <button id="tutorNivelIntermedio" class="btn-nivel">ğŸŒ¿ Nivel Intermedio</button>
      <button id="tutorNivelAvanzado" class="btn-nivel">ğŸŒ³ Nivel Avanzado</button>
      <button id="tutorNivelExperto" class="btn-nivel">ğŸ”¥ Nivel Experto</button>
      <button class="btn-ghost" type="button" title="Limpiar cachÃ© del JSON y recargar">â†» Refrescar datos</button>
    </div>
  </section>

  <!-- PÃ¡gina 2.6: Panel del Tutor (despuÃ©s de configurar) -->
  <section id="page-tutor" class="page">
    <div class="card">
      <h3>ğŸ“ Panel del Tutor</h3>
      
      <!-- Resumen de configuraciÃ³n -->
      <div id="tutorConfigSummary" class="config-summary">
        <h4>âš™ï¸ ConfiguraciÃ³n del Ejercicio</h4>
        <div id="configDetails"></div>
        <button class="btn-ghost">âœï¸ Modificar ConfiguraciÃ³n</button>
      </div>
      
      <div id="tutorStatus" class="status-panel">
        <p>Iniciando servidor PeerJS...</p>
      </div>
      
      <div id="sessionInfo" style="display: none;">
        <div class="session-card">
          <h4>ğŸ“¡ InformaciÃ³n de la SesiÃ³n</h4>
          <div class="session-details">
            <div class="session-header-row">
              <p class="session-id-row"><strong>ID de SesiÃ³n:</strong> <span id="sessionId" class="session-id">-</span> <button id="btnCopySessionId" class="btn-ghost" type="button" title="Copiar ID">ğŸ“‹</button></p>
              <button id="btnShowQR" title="Mostrar cÃ³digo QR de la sesiÃ³n">ğŸ“± Mostrar QR</button>
            </div>
            <p class="session-status-row"><strong>Estado:</strong> <span id="serverStatus">Conectando...</span></p>
          </div>
        </div>
        <div class="tutor-controls">
          <button id="startExercise" disabled>â–¶ï¸ Iniciar Ejercicio</button>
          <button id="tutorStopAll" class="btn-ghost">â›” Bloquear pantallas</button>
          <button id="tutorNewExercise" class="btn-ghost">ğŸ†• Nuevo ejercicio</button>
          <button id="tutorNewSession" class="btn-ghost">ğŸ”„ Nueva SesiÃ³n</button>
          <button id="stopSession" class="btn-ghost">â¹ï¸ Terminar SesiÃ³n</button>
        </div>
        <!-- Controles de reproducciÃ³n del tutor (arriba de participantes) -->
        <div id="tutorPlayback" class="tutor-controls" style="display:none;">
          <!-- Fila superior: Mostrar palabra + Palabra actual -->
          <div class="row-top">
            <div>
              <label class="inline">
                <input type="checkbox" id="showCurrentWord" onchange="refreshTutorCurrentWordLabel()"> Mostrar palabra
              </label>
              <strong>Palabra actual:</strong> <span id="tutorCurrentWord">â€”</span>
            </div>
            <div>
              <label class="inline">
                <input type="checkbox" id="participantAudio"> Reproducir audio en participantes
              </label>
              <span class="hint hint-muted">Por defecto desactivado. El tutor siempre reproduce audio.</span>
            </div>
            <!-- Barra de progreso larga (misma que participantes) con contador a la derecha -->
            <div class="progress-row">
              <div class="progress">
                <div id="tutorOverallProgressFill"></div>
              </div>
              <span id="tutorOverallProgressText" class="hint">0/0</span>
            </div>
          </div>
          <!-- Fila inferior: Progreso/Resp a la izquierda y botones a la derecha -->
          <div class="row-bottom">
            <div class="left"></div>
            <div class="actions">
              <button id="tutorPlayWord">â–¶ï¸ Reproducir</button>
              <button id="tutorNextWord">Siguiente â–¶</button>
              <label class="inline" style="display:flex; align-items:center; gap:6px;">
                <input type="checkbox" id="autoAdvance"> Auto
              </label>
              <select id="autoDelay">
                <option value="1500">1.5 s</option>
                <option value="2000">2 s</option>
                <option value="3000">3 s</option>
                <option value="4000" selected>4 s</option>
                <option value="5000">5 s</option>
              </select>
              <span class="hint" id="tutorResponses" style="margin-left:8px;">Resp: 0/0</span>
            </div>
          </div>
        </div>

        <div class="participants-panel">
          <h4>ğŸ‘¥ Participantes Conectados (<span id="participantCount">0</span>)</h4>
          <div id="participantsList" class="participants-list">
            <p class="no-participants">No hay participantes conectados</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- PÃ¡gina 2.6: Interfaz del Participante -->
  <section id="page-participant" class="page">
    <div class="card">
      <h3>ğŸ“ Panel del Participante</h3>
      
      <div id="participantConnection" class="connection-panel">
        <div class="form-field">
          <label for="participantName"><strong>Tu Nombre:</strong></label>
          <input id="participantName" type="text" placeholder="Ingresa tu nombre y apellido" tabindex="1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
        </div>
        <div class="form-field">
          <label for="participantEdad"><strong>Edad:</strong></label>
          <input id="participantEdad" type="number" min="6" max="99" placeholder="Ingresa tu edad (mÃ­nimo 6 aÃ±os)" tabindex="2" autocomplete="off" title="La edad mÃ­nima es de 6 aÃ±os" required oninvalid="this.setCustomValidity('Por favor, ingresa una edad vÃ¡lida. La edad mÃ­nima es de 6 aÃ±os.')" oninput="this.setCustomValidity('')">
          <div class="hint" style="font-size: 0.85rem; color: #666; margin-top: 4px;">
            â„¹ï¸ La edad mÃ­nima es de <strong>6 aÃ±os</strong>.
          </div>
        </div>
        <div class="form-field">
          <label for="sessionIdInput"><strong>ID de SesiÃ³n del Tutor (MAYÃšSCULAS):</strong></label>
          <input id="sessionIdInput" type="text" placeholder="Ingresa el ID de sesiÃ³n" tabindex="3" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
          <div class="hint session-id-hint">
            âš ï¸ Importante: el ID <strong>distingue mayÃºsculas</strong>. EscrÃ­belo en <strong>MAYÃšSCULAS</strong> (ej.: <code>TUTOR_AB12CD</code>).
          </div>
        </div>
        <button id="connectToSession" tabindex="4">ğŸ”— Conectar a SesiÃ³n</button>
      </div>
      
      <div id="participantStatus" class="status-panel" style="display: none;">
        <p id="connectionStatus">Conectando...</p>
      </div>
      
      <div id="participantExercise" class="exercise-panel" style="display: none;">
        <div class="participant-info">
          <p><strong>Alumno:</strong> <span id="participantDisplayName">-</span></p>
          <p><strong>Conectado a:</strong> <span id="connectedSession">-</span></p>
          <p><strong>Estado:</strong> <span id="exerciseStatus">Esperando...</span></p>
        </div>
        
        <div id="participantGame" style="display: none;">
          <!-- Nota: El audio se reproduce automÃ¡ticamente cuando tocas la pantalla o el input -->
          <!-- Progreso del participante (arriba del cuadro de texto) -->
          <div class="participant-progress" style="margin-top: 16px;">
            <div class="progress" aria-label="Progreso de palabras">
              <div id="participantProgressFill" class="progress-fill" style="width:0%"></div>
            </div>
            <div id="participantProgressText" class="progress-text">0/0</div>
          </div>

          <div class="participant-input">
            <input type="text" id="participantAnswer" placeholder="Escribe la palabra aquÃ­" 
                   autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" 
                   data-gramm="false">
            <button>âœ“ Confirmar</button>
          </div>
          
          <div id="participantFeedback" class="participant-feedback"></div>
        </div>
        
        <!-- Reporte del participante (despuÃ©s del ejercicio) -->
        <div id="participantReport" style="display: none;">
          <h4>ğŸ“Š Tu Reporte</h4>
          <div class="actions">
            <button>â¬‡ï¸ Descargar PDF</button>
            <button>ğŸ“ PrÃ¡ctica Manual</button>
          </div>
          <div id="participantReportContent"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- PÃ¡gina 3: Reporte final -->
  <section id="page-report" class="page">
    <div class="actions" style="margin-top: 6px;">
      <button class="btn-ghost">â—‚ Nueva SesiÃ³n</button>
      <button class="btn-ghost">Nuevo ejercicio</button>
      <button>â¬‡ï¸ Reporte PDF</button>
      <button>ğŸ“ PrÃ¡ctica Manual</button>
    </div>
    <div class="card" style="margin-top: 14px;">
      <div id="reporteFinal" class="status"></div>
    </div>
  </section>

  <!-- LibrerÃ­as para generar PDF en el navegador -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.0/dist/jspdf.plugin.autotable.min.js"></script>
  <!-- PeerJS para comunicaciÃ³n P2P -->
  <script src="https://unpkg.com/peerjs@1.5.0/dist/peerjs.min.js"></script>
  <!-- Simple Keyboard (solo se inicializa en mÃ³viles/tablets) -->
  <script src="https://cdn.jsdelivr.net/npm/simple-keyboard@latest/build/index.js"></script>
  <!-- Confetti para animaciones de Ã©xito -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <!-- QRCode generator (qrious - librerÃ­a moderna y confiable) -->
  <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
  <!-- MÃ³dulos del sistema: (se cargan mÃ¡s abajo con onload/onerror y logs) -->
  
  <!-- Modal personalizado para confirmaciÃ³n de descarga -->
  <div id="downloadModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle">âœ… Descarga Completada</h3>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <p id="modalMessage">Archivo descargado exitosamente</p>
        <div class="modal-actions">
          <button id="openFileBtn" class="btn-primary">ğŸ“‚ Abrir Archivo</button>
          <button class="btn-ghost">Cancelar</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Contenedor inline para Teclado Virtual (solo mÃ³viles/tablets) -->
  <div id="vk-inline" class="vk-inline-container" style="display:none;" aria-hidden="true">
    <div class="simple-keyboard"></div>
  </div>

  </div>

  <!-- Template: Tarjeta compacta de participante cargado externamente -->

  <!-- Templates: Banners de lÃ­mite de participantes (Peer) -->
  <template id="tplSoftLimitBanner">
    <div class="peer-banner peer-banner--soft card" id="softLimitBanner">
      <div class="peer-banner__icon">â„¹ï¸</div>
      <div class="peer-banner__content">
        <h4 class="peer-banner__title">InformaciÃ³n sobre LÃ­mite de Participantes</h4>
        <p class="peer-banner__text">
          Tienes <strong class="peer-count">0</strong> participantes conectados. El lÃ­mite gratuito establecido es de <strong>10 participantes por sesiÃ³n</strong>.
        </p>
        <p class="peer-banner__text">
          Durante este perÃ­odo inicial, puedes continuar usando con mÃ¡s participantes. Si planeas usar regularmente con grupos grandes, te invitamos a contactar para una licencia institucional.
        </p>
        <p class="peer-banner__actions">
          <a class="peer-link" target="_blank">ğŸ“§ MÃ¡s informaciÃ³n</a>
          <button class="peer-close btn-ghost" type="button">Entendido</button>
        </p>
      </div>
    </div>
  </template>

  <template id="tplHardLimitBanner">
    <div class="peer-banner peer-banner--hard card" id="groupLimitBanner">
      <div class="peer-banner__content">
        <h4 class="peer-banner__title">âš ï¸ LÃ­mite de Participantes Alcanzado</h4>
        <p class="peer-banner__text">Has alcanzado el lÃ­mite de <strong class="peer-limit">10 participantes gratuitos</strong>.</p>
        <p class="peer-banner__text">Para usar el modo grupal con mÃ¡s participantes, contacta:</p>
        <p class="peer-banner__actions">
          <a class="peer-link" target="_blank">ğŸ“§ hgomero@gmail.com</a>
        </p>
        <p class="peer-banner__foot"><em>Respuesta en 24-48 horas.</em></p>
      </div>
    </div>
  </template>

  <!-- Templates: Feedback del participante -->
  <template id="tplFbCorrect">
    <p class="fb-correct">âœ… Â¡Correcto!</p>
  </template>
  <template id="tplFbIncorrect">
    <p class="fb-incorrect">âŒ Incorrecto. Escribiste: <strong class="fb-typed"></strong> | Era: <strong class="fb-correct-word"></strong></p>
  </template>

  <!-- Template: Overlay de bloqueo del participante -->
  <template id="tplParticipantLockOverlay">
    <div class="participant-lock-overlay" id="participantLockOverlay">
      <div class="plo-card">
        <div class="plo-emoji">â›”</div>
        <div class="plo-title">Pantalla Bloqueada</div>
        <div class="plo-text">Espera indicaciones del tutor para continuar</div>
      </div>
    </div>
  </template>

  <!-- Pie de pÃ¡gina -->
  <footer>
    <div style="width: 100%; max-width: 980px; margin: 0 auto; text-align: center; padding: 8px 0 4px;">
      <p style="margin: 0; font-size: 12px; color: #334155; line-height: 1.4;">
        <strong>Â© 2025 GMR - Todos los derechos reservados</strong> Â· 
        <span style="font-size: 11px; color: #64748b;">CÃ³digo propietario. Prohibida su modificaciÃ³n o redistribuciÃ³n.</span>
      </p>
      <p style="margin: 2px 0 0; font-size: 11px; line-height: 1.3;">
        <a href="assets/politicas-privacidad.html" style="color: #0ea5e9; text-decoration: none; margin: 0 4px;">PolÃ­ticas de Privacidad</a> |
        <a href="LICENSE.md" style="color: #0ea5e9; text-decoration: none; margin: 0 4px;">Licencia</a> |
        <a href="mailto:hgomero@gmail.com" style="color: #0ea5e9; text-decoration: none; margin: 0 4px;">Contacto</a>
      </p>
    </div>
  </footer>
  
  <!-- Modal para QR de sesiÃ³n (fuera de secciones .page) -->
  <div id="qrModal" class="modal" style="display:none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ConÃ©ctate por QR</h3>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <div id="qrCodeContainer"></div>
        <div id="qrSessionIdRow">
          ID de SesiÃ³n: <code id="qrSessionId">-</code>
        </div>
        <div class="hint">Escanea con el dispositivo del participante. PrecargarÃ¡ el ID de sesiÃ³n automÃ¡ticamente.</div>
      </div>
      <div class="modal-actions">
        <button class="btn-primary">Cerrar</button>
      </div>
    </div>
  </div>
  
  
  
  <!-- Scripts principales -->
  <!-- Device Detector debe cargarse primero -->
  <script src="modules/device-detector.js" onload="console.log('âœ… modules/device-detector.js cargado')" onerror="console.error('âŒ Error cargando modules/device-detector.js')"></script>
  <script src="modules/virtual-keyboard.js" onload="console.log('âœ… modules/virtual-keyboard.js cargado')" onerror="console.error('âŒ Error cargando modules/virtual-keyboard.js')"></script>
  <script src="modules/cache.js" onload="console.log('âœ… modules/cache.js cargado')" onerror="console.error('âŒ Error cargando modules/cache.js')"></script>
  <script src="modules/navigation.js" onload="console.log('âœ… modules/navigation.js cargado')" onerror="console.error('âŒ Error cargando modules/navigation.js')"></script>
  <script src="modules/voice-strategy.js" onload="console.log('âœ… modules/voice-strategy.js cargado')" onerror="console.error('âŒ Error cargando modules/voice-strategy.js')"></script>
  <script src="modules/tts.js" onload="console.log('âœ… modules/tts.js cargado')" onerror="console.error('âŒ Error cargando modules/tts.js')"></script>
  <!-- Config debe cargarse antes de data-loader y resto de mÃ³dulos -->
  <script src="modules/config.js" onload="console.log('âœ… modules/config.js cargado')" onerror="console.error('âŒ Error cargando modules/config.js')"></script>
  <!-- Definir ruta del JSON antes del cargador de datos -->
  <script>
    // Overrides opcionales de CONFIG (si quieres cambiar por entorno)
    window.CONFIG = Object.assign(window.CONFIG || {}, {
      RAE_WORD_LIST_URL: './assets/palabras-con-frecuencia.json',
      // Sistema de CrÃ©ditos de Tiempo (valores por defecto)
      TIME_CREDITS_ENABLED: true,
      TIME_CREDITS_PIN: '1234',
      TIME_CREDITS_DAILY_LIMIT: 45,
      TIME_CREDITS_EXERCISE_LIMIT: 30,
      // Minutos base al 100% antes de aplicar factor de dificultad (nivel/acentos/refuerzo)
      TIME_CREDITS_MAX_BASE_AT_100: 10,
      // Palabras requeridas en el ejercicio para aplicar bonos
      TIME_CREDITS_REQUIRED_WORDS: 25
    });
    // Activar diagnÃ³sticos si se requiere
    window.DEBUG = window.DEBUG ?? true;
  </script>
  <!-- Eliminado: diccionario externo; validaciÃ³n se hace localmente -->
  <!-- MÃ³dulos de utilidades globales -->
  <script src="modules/device-utils.js" onload="console.log('âœ… modules/device-utils.js cargado')" onerror="console.error('âŒ Error cargando modules/device-utils.js')"></script>
  <script src="modules/text-utils.js" onload="console.log('âœ… modules/text-utils.js cargado')" onerror="console.error('âŒ Error cargando modules/text-utils.js')"></script>
  <script src="modules/form-utils.js" onload="console.log('âœ… modules/form-utils.js cargado')" onerror="console.error('âŒ Error cargando modules/form-utils.js')"></script>
  <!-- MÃ³dulo unificado de reproducciÃ³n de audio -->
  <script src="modules/audio-player.js" onload="console.log('âœ… modules/audio-player.js cargado')" onerror="console.error('âŒ Error cargando modules/audio-player.js')"></script>
  <script src="modules/data-loader.js?v=dbg1" onload="console.log('âœ… modules/data-loader.js cargado')" onerror="console.error('âŒ Error cargando modules/data-loader.js')"></script>
  <script src="modules/data.js" onload="console.log('âœ… modules/data.js cargado')" onerror="console.error('âŒ Error cargando modules/data.js')"></script>
  <script src="modules/rae-proxy.js" onload="console.log('âœ… modules/rae-proxy.js cargado')" onerror="console.error('âŒ Error cargando modules/rae-proxy.js')"></script>
  <script src="modules/dev-utils.js" onload="console.log('âœ… modules/dev-utils.js cargado')" onerror="console.error('âŒ Error cargando modules/dev-utils.js')"></script>
  <script src="modules/group-state.js" onload="console.log('âœ… modules/group-state.js cargado')" onerror="console.error('âŒ Error cargando modules/group-state.js')"></script>
  <script src="modules/peer-manager.js" onload="console.log('âœ… modules/peer-manager.js cargado')" onerror="console.error('âŒ Error cargando modules/peer-manager.js')"></script>
  <script src="modules/game-state.js" onload="console.log('âœ… modules/game-state.js cargado')" onerror="console.error('âŒ Error cargando modules/game-state.js')"></script>
  <script src="modules/reportes.js" onload="console.log('âœ… modules/reportes.js cargado')" onerror="console.error('âŒ Error cargando modules/reportes.js')"></script>
  <script src="modules/ui.js" onload="console.log('âœ… modules/ui.js cargado')" onerror="console.error('âŒ Error cargando modules/ui.js')"></script>
  <script src="modules/ui-core.js" onload="console.log('âœ… modules/ui-core.js cargado')" onerror="console.error('âŒ Error cargando modules/ui-core.js')"></script>
  <script src="modules/ui-forms.js" onload="console.log('âœ… modules/ui-forms.js cargado')" onerror="console.error('âŒ Error cargando modules/ui-forms.js')"></script>
  <script src="modules/progress.js" onload="console.log('âœ… modules/progress.js cargado')" onerror="console.error('âŒ Error cargando modules/progress.js')"></script>
  <script src="modules/vk-helpers.js" onload="console.log('âœ… modules/vk-helpers.js cargado')" onerror="console.error('âŒ Error cargando modules/vk-helpers.js')"></script>
  <script src="modules/params.js" onload="console.log('âœ… modules/params.js cargado')" onerror="console.error('âŒ Error cargando modules/params.js')"></script>
  <script src="modules/error-bank.js" onload="console.log('âœ… modules/error-bank.js cargado')" onerror="console.error('âŒ Error cargando modules/error-bank.js')"></script>
  <script src="modules/validation.js" onload="console.log('âœ… modules/validation.js cargado')" onerror="console.error('âŒ Error cargando modules/validation.js')"></script>
  <!-- Constants for router and modules -->
  <script src="modules/constants.js" onload="console.log('âœ… modules/constants.js cargado')" onerror="console.error('âŒ Error cargando modules/constants.js')"></script>
  <script src="modules/router.js?v=tc1" onload="console.log('âœ… modules/router.js cargado (tc1)')" onerror="console.error('âŒ Error cargando modules/router.js')"></script>
  <script src="modules/game-flow.js" onload="console.log('âœ… modules/game-flow.js cargado')" onerror="console.error('âŒ Error cargando modules/game-flow.js')"></script>
  <!-- Ayudas por pÃ¡gina -->
  <script src="modules/page-hints.js" onload="console.log('âœ… modules/page-hints.js cargado')" onerror="console.error('âŒ Error cargando modules/page-hints.js')"></script>
  <script src="modules/feedback.js" onload="console.log('âœ… modules/feedback.js cargado')" onerror="console.error('âŒ Error cargando modules/feedback.js')"></script>
  <!-- MÃ³dulo de CrÃ©ditos de Tiempo -->
  <script src="modules/time-credits.js" onload="console.log('âœ… modules/time-credits.js cargado')" onerror="console.error('âŒ Error cargando modules/time-credits.js')"></script>
  <script src="modules/time-credits-ui.js" onload="console.log('âœ… modules/time-credits-ui.js cargado')" onerror="console.error('âŒ Error cargando modules/time-credits-ui.js')"></script>
  <!-- Debe cargarse antes de app.js para que los wrappers deleguen correctamente -->
  <script src="modules/individual-mode.js?v=dbg1" onload="console.log('âœ… modules/individual-mode.js cargado')" onerror="console.error('âŒ Error cargando modules/individual-mode.js')"></script>
  <!-- MÃ³dulos del modo grupal -->
  <script src="modules/participant-helpers.js" onload="console.log('âœ… modules/participant-helpers.js cargado')" onerror="console.error('âŒ Error cargando modules/participant-helpers.js')"></script>
  <script src="modules/group-mode-tutor.js" onload="console.log('âœ… modules/group-mode-tutor.js cargado')" onerror="console.error('âŒ Error cargando modules/group-mode-tutor.js')"></script>
  <script src="modules/config-block.js" onload="console.log('âœ… modules/config-block.js cargado')" onerror="console.error('âŒ Error cargando modules/config-block.js')"></script>
  <script src="modules/template-loader.js" onload="console.log('âœ… modules/template-loader.js cargado')" onerror="console.error('âŒ Error cargando modules/template-loader.js')"></script>
  <script src="assets/app.js?v=qr2" onload="console.log('âœ… app.js cargado (qr2)')" onerror="console.error('âŒ Error cargando app.js')"></script>
  <script src="modules/init.js"></script>

  <!-- Eliminado: script de diagnÃ³stico duplicado -->
  
  <!-- Inicializador del teclado virtual movido a assets/init.js -->
  
  <!-- ProtecciÃ³n de DevTools movida a assets/init.js -->
</body>
</html>
