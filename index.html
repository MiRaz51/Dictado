<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <!-- Security and download policy -->
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta name="referrer" content="no-referrer">
  <!-- Aplicación optimizada para escritorio -->
  <title>Práctica de Ortografía</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/styles/variables.css">
  <link rel="stylesheet" href="assets/styles/base.css">
  <link rel="stylesheet" href="assets/styles/utilities.css">
  <link rel="stylesheet" href="assets/styles/forms.css">
  <link rel="stylesheet" href="assets/styles.css">
  <!-- CSS modularizado: componentes -->
  <link rel="stylesheet" href="assets/styles/components/help-button.css">
  <link rel="stylesheet" href="assets/styles/components/tutorial.css">
  <link rel="stylesheet" href="assets/styles/components/config-card.css">
  <link rel="stylesheet" href="assets/styles/components/progress.css">
  <link rel="stylesheet" href="assets/styles/components/participant.css">
  <link rel="stylesheet" href="assets/styles/components/tutor.css">
  <link rel="stylesheet" href="assets/styles/components/virtual-keyboard.css">
  <link rel="stylesheet" href="assets/styles/components/reportes.css">
  <link rel="stylesheet" href="assets/styles/components/badges.css">
  <link rel="stylesheet" href="assets/styles/components/feedback.css">
  <link rel="stylesheet" href="assets/styles/components/peer.css">
  <link rel="stylesheet" href="assets/styles/components/time-credits.css">
  <!-- Responsive styles centralized -->
  <link rel="stylesheet" href="assets/styles/responsive.css">
  <!-- Simple Keyboard CSS (solo se usa en móviles/tablets) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-keyboard@latest/build/css/index.css">
  <script src="modules/word-filters-fixed.js" onload="console.log('✅ modules/word-filters-fixed.js cargado')" onerror="console.error('❌ Error cargando modules/word-filters-fixed.js')"></script>
  <script src="modules/filters.js" onload="console.log('✅ modules/filters.js cargado')" onerror="console.error('❌ Error cargando modules/filters.js')"></script>
</head>
<body>
  <!-- Botón de ayuda/tutorial (flotante, fuera del contenedor principal) -->
  <button id="help-btn" class="help-button" title="Ver ayuda de esta página">
    <span>?</span>
  </button>

  <!-- Badge de créditos (flotante, visible solo en páginas de participante/individual) -->
  <button id="tcBadgeBtn" class="tc-badge-floating hidden" title="Ver y canjear créditos de tiempo" type="button">
    ⏱ <span class="tc-mins" id="tcMins">0</span> min · <span id="tcUserShort">-</span>
  </button>
  <!-- Modal de Créditos de Tiempo se carga desde templates/tplTimeCreditsModal.html -->

  <!-- Eliminado: script inline duplicado. Todas las funciones reales están en app.js -->
  <div class="container">
  
  <h2><span class="brand">Práctica</span> de Ortografía</h2>
  <p id="metaAlumnoCurso" class="meta hidden"></p>

  <!-- Página 0: Selección de Modo -->
  <section id="page-mode-select" class="page active">
    <div class="card center">
      <h3 style="margin-bottom: 20px; color: var(--text);">Selecciona el modo de práctica</h3>
      <div class="mode-grid">
        <div id="modeIndividual" class="mode-card" role="button" tabindex="0">
          <div class="mode-icon">👤</div>
          <h4>Individual</h4>
          <p>Práctica personal independiente</p>
        </div>

        <div id="modeGroup" class="mode-card" role="button" tabindex="0">
          <div class="mode-icon">👥</div>
          <h4>Grupal</h4>
          <p>Sesión colaborativa con tutor</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Página 0.5: Selección de Rol Grupal -->
  <section id="page-role-select" class="page">
    <div class="card center">
      <h3 style="margin-bottom: 20px; color: var(--text);">Selecciona tu rol</h3>
      <div class="mode-grid">
        <div class="mode-card">
          <div class="mode-icon">🎓</div>
          <h4>Tutor/Administrador</h4>
          <p>Crear y gestionar la sesión</p>
        </div>
        <div class="mode-card">
          <div class="mode-icon">📝</div>
          <h4>Participante/Alumno</h4>
          <p>Unirse a una sesión existente</p>
        </div>
      </div>
      <div class="actions">
        <button class="btn-ghost">◂ Volver</button>
      </div>
    </div>
  </section>

  <!-- Página 1: Configuración -->
  <section id="page-config" class="page">
    <div class="card" style="margin: 12px 0;">
      <div class="form-row">
        <div class="form-field" style="grid-column: 1 / -1;">
          <label for="alumno"><strong>Participante</strong>:</label>
          <input id="alumno" type="text" placeholder="Nombre y apellido" tabindex="1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
          <div id="alumnoError" class="help-error">Este campo es obligatorio.</div>
        </div>
        <div class="form-field" style="grid-column: 1 / -1;">
          <label for="edad"><strong>Edad</strong>:</label>
          <input id="edad" type="number" min="6" max="99" placeholder="Ingresa tu edad (mínimo 6 años)" tabindex="2" autocomplete="off" title="La edad mínima es de 6 años" required oninvalid="this.setCustomValidity('Por favor, ingresa una edad válida. La edad mínima es de 6 años.')" oninput="this.setCustomValidity('')">
          <div class="hint" style="font-size: 0.85rem; color: #666; margin-top: 4px;">
            ℹ️ La edad mínima es de <strong>6 años</strong>.
          </div>
        </div>
      </div>
    </div>
    <div class="actions">
      <button id="btnNext" class="btn-ghost" disabled tabindex="6">Siguiente ▸</button>
    </div>
  </section>

  <!-- Página 2: Ejercicio -->
  <section id="page-game" class="page">
    <div class="card" style="margin: 12px 0;">
      <div id="config-individual-block"></div>
    </div>
    
    <p>Selecciona un nivel de dificultad:</p>
    
    <div class="actions" style="display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:6px;">
      <button id="btnVolverGame" class="btn-ghost">◂ Volver</button>
      <button id="btnNivelBasico" class="btn-nivel" tabindex="7">🌱 Nivel Básico</button>
      <button id="btnNivelIntermedio" class="btn-nivel" tabindex="8">🌿 Nivel Intermedio</button>
      <button id="btnNivelAvanzado" class="btn-nivel" tabindex="9">🌳 Nivel Avanzado</button>
      <button id="btnNivelExperto" class="btn-nivel" tabindex="10">🔥 Nivel Experto</button>
      <button class="btn-ghost" type="button" title="Limpiar caché del JSON y recargar">↻ Refrescar datos</button>
      <span id="nivelesDiag" class="hint hint-muted hidden"></span>
    </div>
    <div id="juego" class="card mt-14" style="display:none;">
      <div class="avance-row">
        <div class="progress" aria-label="Progreso de palabras">
          <div id="progressFill" class="progress-fill"></div>
        </div>
        <div id="progressText" class="progress-text">0/0</div>
      </div>
      <div class="row layout-game-input">
        <button id="btnSpeak">🔊 Reproducir palabra</button>
        <button id="btnEnableAudio" class="btn-ghost" style="display:none;">Permitir audio</button>
        <input type="text" id="respuesta" placeholder="Escribe aquí" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" data-ms-editor="false" data-gramm="false" data-gramm_editor="false" data-enable-grammarly="false" data-gramm-mode="false" data-lt-installed="false">
        <!-- Espejo visual del input (móvil/tablet) para mostrar un caret falso en la misma posición -->
        <div id="vkMirror" class="vk-mirror" aria-hidden="false">
          <span class="vk-mirror-text"></span><span class="vk-caret"></span>
        </div>
        <button id="btnComprobar">Comprobar</button>
      </div>
      <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
        <p id="resultado" class="status"></p>
        <p id="marcador" class="status"></p>
      </div>
      <div class="actions mt-6">
        <button id="btnToReport" style="display:none;">Siguiente ▸</button>
      </div>
    </div>
  </section>

  <!-- Página 2.4: Información del Tutor (nueva) -->
  <section id="page-tutor-info" class="page">
    <div class="card">
      <h3>🎓 Información del Tutor</h3>
      
      <div class="form-field">
        <label for="tutorName"><strong>Tutor/Administrador:</strong></label>
        <input id="tutorName" type="text" placeholder="Ingresa tu nombre como tutor" tabindex="1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
      </div>
      
      <div class="form-field">
        <label for="tutorGroup"><strong>Grupo/Grado:</strong></label>
        <input id="tutorGroup" type="text" placeholder="Ej: 3° Primaria, Grupo A, etc." tabindex="2" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
      </div>
    </div>
    
    <div class="actions">
      <button class="btn-ghost">◂ Volver</button>
      <button id="btnTutorNext" tabindex="3">Siguiente ▸</button>
    </div>
  </section>

  <!-- Página 2.5: Configuración del Tutor -->
  <section id="page-tutor-config" class="page">
    <div class="card">
      <h3>🎓 Configuración del Ejercicio</h3>
      <div id="config-tutor-block"></div>
    </div>
    
    <p>Selecciona un nivel de dificultad:</p>
    
    <div class="actions">
      <button class="btn-ghost">◂ Volver</button>
      <button id="tutorNivelBasico" class="btn-nivel">🌱 Nivel Básico</button>
      <button id="tutorNivelIntermedio" class="btn-nivel">🌿 Nivel Intermedio</button>
      <button id="tutorNivelAvanzado" class="btn-nivel">🌳 Nivel Avanzado</button>
      <button id="tutorNivelExperto" class="btn-nivel">🔥 Nivel Experto</button>
      <button class="btn-ghost" type="button" title="Limpiar caché del JSON y recargar">↻ Refrescar datos</button>
    </div>
  </section>

  <!-- Página 2.6: Panel del Tutor (después de configurar) -->
  <section id="page-tutor" class="page">
    <div class="card">
      <h3>🎓 Panel del Tutor</h3>
      
      <!-- Resumen de configuración -->
      <div id="tutorConfigSummary" class="config-summary">
        <h4>⚙️ Configuración del Ejercicio</h4>
        <div id="configDetails"></div>
        <button class="btn-ghost">✏️ Modificar Configuración</button>
      </div>
      
      <div id="tutorStatus" class="status-panel">
        <p>Iniciando servidor PeerJS...</p>
      </div>
      
      <div id="sessionInfo" style="display: none;">
        <div class="session-card">
          <h4>📡 Información de la Sesión</h4>
          <div class="session-details">
            <div class="session-header-row">
              <p class="session-id-row"><strong>ID de Sesión:</strong> <span id="sessionId" class="session-id">-</span> <button id="btnCopySessionId" class="btn-ghost" type="button" title="Copiar ID">📋</button></p>
              <button id="btnShowQR" title="Mostrar código QR de la sesión">📱 Mostrar QR</button>
            </div>
            <p class="session-status-row"><strong>Estado:</strong> <span id="serverStatus">Conectando...</span></p>
          </div>
        </div>
        <div class="tutor-controls">
          <button id="startExercise" disabled>▶️ Iniciar Ejercicio</button>
          <button id="tutorStopAll" class="btn-ghost">⛔ Bloquear pantallas</button>
          <button id="tutorNewExercise" class="btn-ghost">🆕 Nuevo ejercicio</button>
          <button id="tutorNewSession" class="btn-ghost">🔄 Nueva Sesión</button>
          <button id="stopSession" class="btn-ghost">⏹️ Terminar Sesión</button>
        </div>
        <!-- Controles de reproducción del tutor (arriba de participantes) -->
        <div id="tutorPlayback" class="tutor-controls" style="display:none;">
          <!-- Fila superior: Mostrar palabra + Palabra actual -->
          <div class="row-top">
            <div>
              <label class="inline">
                <input type="checkbox" id="showCurrentWord" onchange="refreshTutorCurrentWordLabel()"> Mostrar palabra
              </label>
              <strong>Palabra actual:</strong> <span id="tutorCurrentWord">—</span>
            </div>
            <div>
              <label class="inline">
                <input type="checkbox" id="participantAudio"> Reproducir audio en participantes
              </label>
              <span class="hint hint-muted">Por defecto desactivado. El tutor siempre reproduce audio.</span>
            </div>
            <!-- Barra de progreso larga (misma que participantes) con contador a la derecha -->
            <div class="progress-row">
              <div class="progress">
                <div id="tutorOverallProgressFill"></div>
              </div>
              <span id="tutorOverallProgressText" class="hint">0/0</span>
            </div>
          </div>
          <!-- Fila inferior: Progreso/Resp a la izquierda y botones a la derecha -->
          <div class="row-bottom">
            <div class="left"></div>
            <div class="actions">
              <button id="tutorPlayWord">▶️ Reproducir</button>
              <button id="tutorNextWord">Siguiente ▶</button>
              <label class="inline" style="display:flex; align-items:center; gap:6px;">
                <input type="checkbox" id="autoAdvance"> Auto
              </label>
              <select id="autoDelay">
                <option value="1500">1.5 s</option>
                <option value="2000">2 s</option>
                <option value="3000">3 s</option>
                <option value="4000" selected>4 s</option>
                <option value="5000">5 s</option>
              </select>
              <span class="hint" id="tutorResponses" style="margin-left:8px;">Resp: 0/0</span>
            </div>
          </div>
        </div>

        <div class="participants-panel">
          <h4>👥 Participantes Conectados (<span id="participantCount">0</span>)</h4>
          <div id="participantsList" class="participants-list">
            <p class="no-participants">No hay participantes conectados</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Página 2.6: Interfaz del Participante -->
  <section id="page-participant" class="page">
    <div class="card">
      <h3>📝 Panel del Participante</h3>
      
      <div id="participantConnection" class="connection-panel">
        <div class="form-field">
          <label for="participantName"><strong>Tu Nombre:</strong></label>
          <input id="participantName" type="text" placeholder="Ingresa tu nombre y apellido" tabindex="1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
        </div>
        <div class="form-field">
          <label for="participantEdad"><strong>Edad:</strong></label>
          <input id="participantEdad" type="number" min="6" max="99" placeholder="Ingresa tu edad (mínimo 6 años)" tabindex="2" autocomplete="off" title="La edad mínima es de 6 años" required oninvalid="this.setCustomValidity('Por favor, ingresa una edad válida. La edad mínima es de 6 años.')" oninput="this.setCustomValidity('')">
          <div class="hint" style="font-size: 0.85rem; color: #666; margin-top: 4px;">
            ℹ️ La edad mínima es de <strong>6 años</strong>.
          </div>
        </div>
        <div class="form-field">
          <label for="sessionIdInput"><strong>ID de Sesión del Tutor (MAYÚSCULAS):</strong></label>
          <input id="sessionIdInput" type="text" placeholder="Ingresa el ID de sesión" tabindex="3" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
          <div class="hint session-id-hint">
            ⚠️ Importante: el ID <strong>distingue mayúsculas</strong>. Escríbelo en <strong>MAYÚSCULAS</strong> (ej.: <code>TUTOR_AB12CD</code>).
          </div>
        </div>
        <button id="connectToSession" tabindex="4">🔗 Conectar a Sesión</button>
      </div>
      
      <div id="participantStatus" class="status-panel" style="display: none;">
        <p id="connectionStatus">Conectando...</p>
      </div>
      
      <div id="participantExercise" class="exercise-panel" style="display: none;">
        <div class="participant-info">
          <p><strong>Alumno:</strong> <span id="participantDisplayName">-</span></p>
          <p><strong>Conectado a:</strong> <span id="connectedSession">-</span></p>
          <p><strong>Estado:</strong> <span id="exerciseStatus">Esperando...</span></p>
        </div>
        
        <div id="participantGame" style="display: none;">
          <!-- Nota: El audio se reproduce automáticamente cuando tocas la pantalla o el input -->
          <!-- Progreso del participante (arriba del cuadro de texto) -->
          <div class="participant-progress" style="margin-top: 16px;">
            <div class="progress" aria-label="Progreso de palabras">
              <div id="participantProgressFill" class="progress-fill" style="width:0%"></div>
            </div>
            <div id="participantProgressText" class="progress-text">0/0</div>
          </div>

          <div class="participant-input">
            <input type="text" id="participantAnswer" placeholder="Escribe la palabra aquí" 
                   autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" 
                   data-gramm="false">
            <button>✓ Confirmar</button>
          </div>
          
          <div id="participantFeedback" class="participant-feedback"></div>
        </div>
        
        <!-- Reporte del participante (después del ejercicio) -->
        <div id="participantReport" style="display: none;">
          <h4>📊 Tu Reporte</h4>
          <div class="actions">
            <button>⬇️ Descargar PDF</button>
            <button>📝 Práctica Manual</button>
          </div>
          <div id="participantReportContent"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Página 3: Reporte final -->
  <section id="page-report" class="page">
    <div class="actions" style="margin-top: 6px;">
      <button class="btn-ghost">◂ Nueva Sesión</button>
      <button class="btn-ghost">Nuevo ejercicio</button>
      <button>⬇️ Reporte PDF</button>
      <button>📝 Práctica Manual</button>
    </div>
    <div class="card" style="margin-top: 14px;">
      <div id="reporteFinal" class="status"></div>
    </div>
  </section>

  <!-- Librerías para generar PDF en el navegador -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.0/dist/jspdf.plugin.autotable.min.js"></script>
  <!-- PeerJS para comunicación P2P -->
  <script src="https://unpkg.com/peerjs@1.5.0/dist/peerjs.min.js"></script>
  <!-- Simple Keyboard (solo se inicializa en móviles/tablets) -->
  <script src="https://cdn.jsdelivr.net/npm/simple-keyboard@latest/build/index.js"></script>
  <!-- Confetti para animaciones de éxito -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <!-- QRCode generator (qrious - librería moderna y confiable) -->
  <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
  <!-- Módulos del sistema: (se cargan más abajo con onload/onerror y logs) -->
  
  <!-- Modal personalizado para confirmación de descarga -->
  <div id="downloadModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle">✅ Descarga Completada</h3>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <p id="modalMessage">Archivo descargado exitosamente</p>
        <div class="modal-actions">
          <button id="openFileBtn" class="btn-primary">📂 Abrir Archivo</button>
          <button class="btn-ghost">Cancelar</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Contenedor inline para Teclado Virtual (solo móviles/tablets) -->
  <div id="vk-inline" class="vk-inline-container" style="display:none;" aria-hidden="true">
    <div class="simple-keyboard"></div>
  </div>

  </div>

  <!-- Template: Tarjeta compacta de participante cargado externamente -->

  <!-- Templates: Banners de límite de participantes (Peer) -->
  <template id="tplSoftLimitBanner">
    <div class="peer-banner peer-banner--soft card" id="softLimitBanner">
      <div class="peer-banner__icon">ℹ️</div>
      <div class="peer-banner__content">
        <h4 class="peer-banner__title">Información sobre Límite de Participantes</h4>
        <p class="peer-banner__text">
          Tienes <strong class="peer-count">0</strong> participantes conectados. El límite gratuito establecido es de <strong>10 participantes por sesión</strong>.
        </p>
        <p class="peer-banner__text">
          Durante este período inicial, puedes continuar usando con más participantes. Si planeas usar regularmente con grupos grandes, te invitamos a contactar para una licencia institucional.
        </p>
        <p class="peer-banner__actions">
          <a class="peer-link" target="_blank">📧 Más información</a>
          <button class="peer-close btn-ghost" type="button">Entendido</button>
        </p>
      </div>
    </div>
  </template>

  <template id="tplHardLimitBanner">
    <div class="peer-banner peer-banner--hard card" id="groupLimitBanner">
      <div class="peer-banner__content">
        <h4 class="peer-banner__title">⚠️ Límite de Participantes Alcanzado</h4>
        <p class="peer-banner__text">Has alcanzado el límite de <strong class="peer-limit">10 participantes gratuitos</strong>.</p>
        <p class="peer-banner__text">Para usar el modo grupal con más participantes, contacta:</p>
        <p class="peer-banner__actions">
          <a class="peer-link" target="_blank">📧 hgomero@gmail.com</a>
        </p>
        <p class="peer-banner__foot"><em>Respuesta en 24-48 horas.</em></p>
      </div>
    </div>
  </template>

  <!-- Templates: Feedback del participante -->
  <template id="tplFbCorrect">
    <p class="fb-correct">✅ ¡Correcto!</p>
  </template>
  <template id="tplFbIncorrect">
    <p class="fb-incorrect">❌ Incorrecto. Escribiste: <strong class="fb-typed"></strong> | Era: <strong class="fb-correct-word"></strong></p>
  </template>

  <!-- Template: Overlay de bloqueo del participante -->
  <template id="tplParticipantLockOverlay">
    <div class="participant-lock-overlay" id="participantLockOverlay">
      <div class="plo-card">
        <div class="plo-emoji">⛔</div>
        <div class="plo-title">Pantalla Bloqueada</div>
        <div class="plo-text">Espera indicaciones del tutor para continuar</div>
      </div>
    </div>
  </template>

  <!-- Pie de página -->
  <footer>
    <div style="width: 100%; max-width: 980px; margin: 0 auto; text-align: center; padding: 8px 0 4px;">
      <p style="margin: 0; font-size: 12px; color: #334155; line-height: 1.4;">
        <strong>© 2025 GMR - Todos los derechos reservados</strong> · 
        <span style="font-size: 11px; color: #64748b;">Código propietario. Prohibida su modificación o redistribución.</span>
      </p>
      <p style="margin: 2px 0 0; font-size: 11px; line-height: 1.3;">
        <a href="assets/politicas-privacidad.html" style="color: #0ea5e9; text-decoration: none; margin: 0 4px;">Políticas de Privacidad</a> |
        <a href="LICENSE.md" style="color: #0ea5e9; text-decoration: none; margin: 0 4px;">Licencia</a> |
        <a href="mailto:hgomero@gmail.com" style="color: #0ea5e9; text-decoration: none; margin: 0 4px;">Contacto</a>
      </p>
    </div>
  </footer>
  
  <!-- Modal para QR de sesión (fuera de secciones .page) -->
  <div id="qrModal" class="modal" style="display:none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Conéctate por QR</h3>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <div id="qrCodeContainer"></div>
        <div id="qrSessionIdRow">
          ID de Sesión: <code id="qrSessionId">-</code>
        </div>
        <div class="hint">Escanea con el dispositivo del participante. Precargará el ID de sesión automáticamente.</div>
      </div>
      <div class="modal-actions">
        <button class="btn-primary">Cerrar</button>
      </div>
    </div>
  </div>
  
  
  
  <!-- Scripts principales -->
  <!-- Device Detector debe cargarse primero -->
  <script src="modules/device-detector.js" onload="console.log('✅ modules/device-detector.js cargado')" onerror="console.error('❌ Error cargando modules/device-detector.js')"></script>
  <script src="modules/virtual-keyboard.js" onload="console.log('✅ modules/virtual-keyboard.js cargado')" onerror="console.error('❌ Error cargando modules/virtual-keyboard.js')"></script>
  <script src="modules/cache.js" onload="console.log('✅ modules/cache.js cargado')" onerror="console.error('❌ Error cargando modules/cache.js')"></script>
  <script src="modules/navigation.js" onload="console.log('✅ modules/navigation.js cargado')" onerror="console.error('❌ Error cargando modules/navigation.js')"></script>
  <script src="modules/voice-strategy.js" onload="console.log('✅ modules/voice-strategy.js cargado')" onerror="console.error('❌ Error cargando modules/voice-strategy.js')"></script>
  <script src="modules/tts.js" onload="console.log('✅ modules/tts.js cargado')" onerror="console.error('❌ Error cargando modules/tts.js')"></script>
  <!-- Config debe cargarse antes de data-loader y resto de módulos -->
  <script src="modules/config.js" onload="console.log('✅ modules/config.js cargado')" onerror="console.error('❌ Error cargando modules/config.js')"></script>
  <!-- Definir ruta del JSON antes del cargador de datos -->
  <script>
    // Overrides opcionales de CONFIG (si quieres cambiar por entorno)
    window.CONFIG = Object.assign(window.CONFIG || {}, {
      RAE_WORD_LIST_URL: './assets/palabras-con-frecuencia.json',
      // Sistema de Créditos de Tiempo (valores por defecto)
      TIME_CREDITS_ENABLED: true,
      TIME_CREDITS_PIN: '1234',
      TIME_CREDITS_DAILY_LIMIT: 45,
      TIME_CREDITS_EXERCISE_LIMIT: 30,
      // Minutos base al 100% antes de aplicar factor de dificultad (nivel/acentos/refuerzo)
      TIME_CREDITS_MAX_BASE_AT_100: 10,
      // Palabras requeridas en el ejercicio para aplicar bonos
      TIME_CREDITS_REQUIRED_WORDS: 25
    });
    // Activar diagnósticos si se requiere
    window.DEBUG = window.DEBUG ?? true;
  </script>
  <!-- Eliminado: diccionario externo; validación se hace localmente -->
  <!-- Módulos de utilidades globales -->
  <script src="modules/device-utils.js" onload="console.log('✅ modules/device-utils.js cargado')" onerror="console.error('❌ Error cargando modules/device-utils.js')"></script>
  <script src="modules/text-utils.js" onload="console.log('✅ modules/text-utils.js cargado')" onerror="console.error('❌ Error cargando modules/text-utils.js')"></script>
  <script src="modules/form-utils.js" onload="console.log('✅ modules/form-utils.js cargado')" onerror="console.error('❌ Error cargando modules/form-utils.js')"></script>
  <!-- Módulo unificado de reproducción de audio -->
  <script src="modules/audio-player.js" onload="console.log('✅ modules/audio-player.js cargado')" onerror="console.error('❌ Error cargando modules/audio-player.js')"></script>
  <script src="modules/data-loader.js?v=dbg1" onload="console.log('✅ modules/data-loader.js cargado')" onerror="console.error('❌ Error cargando modules/data-loader.js')"></script>
  <script src="modules/data.js" onload="console.log('✅ modules/data.js cargado')" onerror="console.error('❌ Error cargando modules/data.js')"></script>
  <script src="modules/rae-proxy.js" onload="console.log('✅ modules/rae-proxy.js cargado')" onerror="console.error('❌ Error cargando modules/rae-proxy.js')"></script>
  <script src="modules/dev-utils.js" onload="console.log('✅ modules/dev-utils.js cargado')" onerror="console.error('❌ Error cargando modules/dev-utils.js')"></script>
  <script src="modules/group-state.js" onload="console.log('✅ modules/group-state.js cargado')" onerror="console.error('❌ Error cargando modules/group-state.js')"></script>
  <script src="modules/peer-manager.js" onload="console.log('✅ modules/peer-manager.js cargado')" onerror="console.error('❌ Error cargando modules/peer-manager.js')"></script>
  <script src="modules/game-state.js" onload="console.log('✅ modules/game-state.js cargado')" onerror="console.error('❌ Error cargando modules/game-state.js')"></script>
  <script src="modules/reportes.js" onload="console.log('✅ modules/reportes.js cargado')" onerror="console.error('❌ Error cargando modules/reportes.js')"></script>
  <script src="modules/ui.js" onload="console.log('✅ modules/ui.js cargado')" onerror="console.error('❌ Error cargando modules/ui.js')"></script>
  <script src="modules/ui-core.js" onload="console.log('✅ modules/ui-core.js cargado')" onerror="console.error('❌ Error cargando modules/ui-core.js')"></script>
  <script src="modules/ui-forms.js" onload="console.log('✅ modules/ui-forms.js cargado')" onerror="console.error('❌ Error cargando modules/ui-forms.js')"></script>
  <script src="modules/progress.js" onload="console.log('✅ modules/progress.js cargado')" onerror="console.error('❌ Error cargando modules/progress.js')"></script>
  <script src="modules/vk-helpers.js" onload="console.log('✅ modules/vk-helpers.js cargado')" onerror="console.error('❌ Error cargando modules/vk-helpers.js')"></script>
  <script src="modules/params.js" onload="console.log('✅ modules/params.js cargado')" onerror="console.error('❌ Error cargando modules/params.js')"></script>
  <script src="modules/error-bank.js" onload="console.log('✅ modules/error-bank.js cargado')" onerror="console.error('❌ Error cargando modules/error-bank.js')"></script>
  <script src="modules/validation.js" onload="console.log('✅ modules/validation.js cargado')" onerror="console.error('❌ Error cargando modules/validation.js')"></script>
  <!-- Constants for router and modules -->
  <script src="modules/constants.js" onload="console.log('✅ modules/constants.js cargado')" onerror="console.error('❌ Error cargando modules/constants.js')"></script>
  <script src="modules/router.js?v=tc1" onload="console.log('✅ modules/router.js cargado (tc1)')" onerror="console.error('❌ Error cargando modules/router.js')"></script>
  <script src="modules/game-flow.js" onload="console.log('✅ modules/game-flow.js cargado')" onerror="console.error('❌ Error cargando modules/game-flow.js')"></script>
  <!-- Ayudas por página -->
  <script src="modules/page-hints.js" onload="console.log('✅ modules/page-hints.js cargado')" onerror="console.error('❌ Error cargando modules/page-hints.js')"></script>
  <script src="modules/feedback.js" onload="console.log('✅ modules/feedback.js cargado')" onerror="console.error('❌ Error cargando modules/feedback.js')"></script>
  <!-- Módulo de Créditos de Tiempo -->
  <script src="modules/time-credits.js" onload="console.log('✅ modules/time-credits.js cargado')" onerror="console.error('❌ Error cargando modules/time-credits.js')"></script>
  <script src="modules/time-credits-ui.js" onload="console.log('✅ modules/time-credits-ui.js cargado')" onerror="console.error('❌ Error cargando modules/time-credits-ui.js')"></script>
  <!-- Debe cargarse antes de app.js para que los wrappers deleguen correctamente -->
  <script src="modules/individual-mode.js?v=dbg1" onload="console.log('✅ modules/individual-mode.js cargado')" onerror="console.error('❌ Error cargando modules/individual-mode.js')"></script>
  <!-- Módulos del modo grupal -->
  <script src="modules/participant-helpers.js" onload="console.log('✅ modules/participant-helpers.js cargado')" onerror="console.error('❌ Error cargando modules/participant-helpers.js')"></script>
  <script src="modules/group-mode-tutor.js" onload="console.log('✅ modules/group-mode-tutor.js cargado')" onerror="console.error('❌ Error cargando modules/group-mode-tutor.js')"></script>
  <script src="modules/config-block.js" onload="console.log('✅ modules/config-block.js cargado')" onerror="console.error('❌ Error cargando modules/config-block.js')"></script>
  <script src="modules/template-loader.js" onload="console.log('✅ modules/template-loader.js cargado')" onerror="console.error('❌ Error cargando modules/template-loader.js')"></script>
  <script src="assets/app.js?v=qr2" onload="console.log('✅ app.js cargado (qr2)')" onerror="console.error('❌ Error cargando app.js')"></script>
  <script src="modules/init.js"></script>

  <!-- Eliminado: script de diagnóstico duplicado -->
  
  <!-- Inicializador del teclado virtual movido a assets/init.js -->
  
  <!-- Protección de DevTools movida a assets/init.js -->
</body>
</html>
