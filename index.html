<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Aplicaci√≥n optimizada para escritorio -->
  <title>Pr√°ctica de Ortograf√≠a</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/styles.css">
  <!-- Simple Keyboard CSS (solo se usa en m√≥viles/tablets) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-keyboard@latest/build/css/index.css">
  <script src="modules/word-filters-fixed.js" onload="console.log('‚úÖ modules/word-filters-fixed.js cargado')" onerror="console.error('‚ùå Error cargando modules/word-filters-fixed.js')"></script>
</head>
<body>
  <!-- Eliminado: script inline duplicado. Todas las funciones reales est√°n en app.js -->
  <div class="container">
  <h2><span class="brand">Pr√°ctica</span> de Ortograf√≠a</h2>
  <p id="metaAlumnoCurso" class="meta" style="display:none;"></p>

  <!-- P√°gina 0: Selecci√≥n de Modo -->
  <section id="page-mode-select" class="page active">
    <div class="card" style="text-align: center;">
      <h3 style="margin-bottom: 20px; color: var(--text);">Selecciona el modo de pr√°ctica</h3>
      <div class="mode-grid">
        <div id="modeIndividual" class="mode-card" role="button" tabindex="0" onclick="selectMode('individual')">
          <div class="mode-icon">üë§</div>
          <h4>Individual</h4>
          <p>Pr√°ctica personal independiente</p>
        </div>
        <div id="modeGroup" class="mode-card" role="button" tabindex="0" onclick="selectMode('group')">
          <div class="mode-icon">üë•</div>
          <h4>Grupal</h4>
          <p>Sesi√≥n colaborativa con tutor</p>
        </div>
      </div>
    </div>
  </section>

  <!-- P√°gina 0.5: Selecci√≥n de Rol Grupal -->
  <section id="page-role-select" class="page">
    <div class="card" style="text-align: center;">
      <h3 style="margin-bottom: 20px; color: var(--text);">Selecciona tu rol</h3>
      <div class="mode-grid">
        <div class="mode-card" onclick="selectRole('tutor')">
          <div class="mode-icon">üéì</div>
          <h4>Tutor/Administrador</h4>
          <p>Crear y gestionar la sesi√≥n</p>
        </div>
        <div class="mode-card" onclick="selectRole('participant')">
          <div class="mode-icon">üìù</div>
          <h4>Participante/Alumno</h4>
          <p>Unirse a una sesi√≥n existente</p>
        </div>
      </div>
      <div class="actions" style="margin-top: 20px;">
        <button class="btn-ghost" onclick="goToPage('page-mode-select')">‚óÇ Volver</button>
      </div>
    </div>
  </section>

  <!-- P√°gina 1: Configuraci√≥n -->
  <section id="page-config" class="page">
    <div class="card" style="margin: 12px 0;">
      <div class="form-row">
        <div class="form-field" style="grid-column: 1 / -1;">
          <label for="alumno"><strong>Participante</strong>:</label>
          <input id="alumno" type="text" placeholder="Nombre y apellido" tabindex="1" oninput="validateFields()" onkeydown="handleEnterNavigation(event, 'btnNext')" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
          <div id="alumnoError" class="help-error">Este campo es obligatorio.</div>
        </div>
      </div>
    </div>
    <div class="actions">
      <button id="btnNext" class="btn-ghost" onclick="goNextFromConfig()" disabled tabindex="6">Siguiente ‚ñ∏</button>
    </div>
  </section>

  <!-- P√°gina 2: Ejercicio -->
  <section id="page-game" class="page">
    <div class="card" style="margin: 12px 0;">
      <!-- 1. Cantidad de palabras -->
      <label for="cantidad"><strong>Cantidad de palabras</strong>: </label>
      <input id="cantidad" type="number" min="1" step="1" placeholder="vac√≠o = 25" style="width: 90px;" tabindex="1" onkeydown="handleEnterNavigation(event, 'filtroLetras')">
      <div class="hint">Al no ingresar cantidad, ser√° 25 palabras como m√°ximo disponible.</div>
      <br><br>
      
      <!-- 3. Letras a reforzar -->
      <label for="filtroLetras"><strong>Letras a reforzar</strong> (solo una letra o combinaci√≥n, ej.: rr): </label>
      <input id="filtroLetras" type="text" placeholder="ej.: rr" style="max-width: 320px;" tabindex="2" oninput="filtrarLetrasEspanol(this)" onkeydown="handleEnterNavigation(event, 'porcentajeRefuerzo')" autocomplete="off" autocorrect="off" spellcheck="false" data-gramm="false">
      <div class="row" style="margin-top: 8px; align-items: center;">
        <label for="porcentajeRefuerzo" style="min-width: 220px;"><strong>Porcentaje de refuerzo</strong> (0‚Äì100%): </label>
        <input id="porcentajeRefuerzo" type="number" min="0" max="100" step="1" placeholder="p. ej.: 40" style="width: 120px;" tabindex="2" onkeydown="handleEnterNavigation(event, 'acentosObligatorios')">
      </div>
      <div class="hint" style="font-size: 12px; color: #666; margin-top: 4px;">
        <strong>Letras individuales:</strong> b, v, g, j, c, z, s, h, x, y, w<br>
        <strong>D√≠grafos:</strong> ll, rr, ch, qu, gu, g√º<br>
        <strong>Grupos conson√°nticos:</strong> br, bl, cr, cl, dr, fl, fr, gl, gr, pl, pr, tr<br>
        <strong>Combinaciones ortogr√°ficas:</strong> cc, sc, xc, mp, mb, nv, nf, nm
      </div>
      <br>
      
      <!-- 5. Modo estricto (validaci√≥n local) -->
      <div style="margin-top:10px; display:flex; align-items:center; gap:10px;">
        <label>
          <input id="strictMode" type="checkbox" checked tabindex="5" onkeydown="handleEnterNavigation(event, 'btnNivelBasico')"> Modo estricto (validaci√≥n local)
        </label>
      </div>
    </div>
    
    <!-- 2. Acentos obligatorios -->
    <div style="margin-top: 10px; margin-bottom: 10px; padding: 10px; background: #f5f5f5; border-radius: 6px;">
      <label style="display: flex; align-items: center; gap: 8px; font-size: 14px;">
        <input id="acentosObligatorios" type="checkbox" style="margin: 0;" tabindex="3" onkeydown="handleEnterNavigation(event, 'btnNivelBasico')">
        <span>Acentos obligatorios (m√°s dif√≠cil)</span>
      </label>
      <div id="acentosHelp" style="font-size: 12px; color: #666; margin-top: 4px;">
        B√°sico: desactivado ¬∑ Intermedio/Avanzado: opcional ¬∑ Experto: siempre activado
      </div>
    </div>
    
    <p>Selecciona un nivel de dificultad:</p>
    
    <div class="actions" style="margin-top: 6px; display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
      <button id="btnVolverGame" class="btn-ghost" onclick="goToPage('page-config')">‚óÇ Volver</button>
      <button id="btnNivelBasico" onkeydown="handleArrowNavigation(event, 'btnNivelIntermedio', 'btnNivelExperto')" tabindex="7">üå± Nivel B√°sico</button>
      <button id="btnNivelIntermedio" onkeydown="handleArrowNavigation(event, 'btnNivelAvanzado', 'btnNivelBasico')" tabindex="8">üåø Nivel Intermedio</button>
      <button id="btnNivelAvanzado" onkeydown="handleArrowNavigation(event, 'btnNivelExperto', 'btnNivelIntermedio')" tabindex="9">üå≥ Nivel Avanzado</button>
      <button id="btnNivelExperto" onkeydown="handleArrowNavigation(event, 'btnNivelBasico', 'btnNivelAvanzado')" tabindex="10">üî• Nivel Experto</button>
      <button class="btn-ghost" type="button" onclick="refrescarDatosRAE()" title="Limpiar cach√© del JSON y recargar">‚Üª Refrescar datos</button>
      <span id="nivelesDiag" class="hint" style="font-size:12px; color:#666; display:none;"></span>
    </div>
    <div id="juego" class="card" style="display:none; margin-top:14px;">
      <div class="avance-row">
        <div class="progress" aria-label="Progreso de palabras">
          <div id="progressFill" class="progress-fill" style="width:0%"></div>
        </div>
        <div id="progressText" class="progress-text">0/0</div>
      </div>
      <div class="row layout-game-input" style="margin-top:6px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
        <button id="btnSpeak" onclick="reproducirPalabra(true)">üîä Reproducir palabra</button>
        <button id="btnEnableAudio" class="btn-ghost" style="display:none;" onclick="unlockTTS(); reproducirPalabra(true)">Permitir audio</button>
        <input type="text" id="respuesta" placeholder="Escribe aqu√≠" style="flex: 1 1 200px; min-width: 0; max-width: 100%;" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" data-ms-editor="false" data-gramm="false" data-gramm_editor="false" data-enable-grammarly="false" data-gramm-mode="false" data-lt-installed="false">
        <!-- Espejo visual del input (m√≥vil/tablet) para mostrar un caret falso en la misma posici√≥n -->
        <div id="vkMirror" class="vk-mirror" aria-hidden="false" style="flex: 1 1 200px; min-width: 0;">
          <span class="vk-mirror-text"></span><span class="vk-caret"></span>
        </div>
        <button id="btnComprobar" onclick="comprobar()">Comprobar</button>
      </div>
      <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
        <p id="resultado" class="status"></p>
        <p id="marcador" class="status"></p>
      </div>
      <div class="actions" style="margin-top:8px;">
        <button id="btnToReport" style="display:none;" onclick="goToReportFromGame()">Siguiente ‚ñ∏</button>
      </div>
    </div>
  </section>

  <!-- P√°gina 2.4: Informaci√≥n del Tutor (nueva) -->
  <section id="page-tutor-info" class="page">
    <div class="card">
      <h3>üéì Informaci√≥n del Tutor</h3>
      
      <div class="form-field">
        <label for="tutorName"><strong>Tutor/Administrador:</strong></label>
        <input id="tutorName" type="text" placeholder="Ingresa tu nombre como tutor" tabindex="1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" onkeydown="if(event.key==='Enter'){event.preventDefault();document.getElementById('tutorGroup').focus();}">
      </div>
      
      <div class="form-field">
        <label for="tutorGroup"><strong>Grupo/Grado:</strong></label>
        <input id="tutorGroup" type="text" placeholder="Ej: 3¬∞ Primaria, Grupo A, etc." tabindex="2" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" onkeydown="if(event.key==='Enter'){event.preventDefault();document.getElementById('btnTutorNext').focus();}">
      </div>
    </div>
    
    <div class="actions" style="margin-top: 12px;">
      <button class="btn-ghost" onclick="goToPage('page-role-select')">‚óÇ Volver</button>
      <button id="btnTutorNext" onclick="goToTutorConfig()" tabindex="3">Siguiente ‚ñ∏</button>
    </div>
  </section>

  <!-- P√°gina 2.5: Configuraci√≥n del Tutor -->
  <section id="page-tutor-config" class="page">
    <div class="card">
      <h3>üéì Configuraci√≥n del Ejercicio</h3>
      
      <div class="form-field">
        <label for="tutorCantidad"><strong>Cantidad de palabras:</strong></label>
        <input id="tutorCantidad" type="number" min="5" max="50" placeholder="20" tabindex="3">
      </div>
      
      <!-- Letras a reforzar -->
      <label for="tutorFiltroLetras"><strong>Letras a reforzar</strong> (solo una letra o combinaci√≥n, ej.: rr): </label>
      <input id="tutorFiltroLetras" type="text" placeholder="ej.: rr" style="max-width: 320px;" tabindex="4" oninput="filtrarLetrasEspanol(this)" autocomplete="off" autocorrect="off" spellcheck="false" data-gramm="false">
      <div class="hint" style="font-size: 12px; color: #666; margin-top: 4px;">
        <strong>Letras individuales:</strong> b, v, g, j, c, z, s, h, x, y, w<br>
        <strong>D√≠grafos:</strong> ll, rr, ch, qu, gu, g√º<br>
        <strong>Grupos conson√°nticos:</strong> br, bl, cr, cl, dr, fl, fr, gl, gr, pl, pr, tr<br>
        <strong>Combinaciones ortogr√°ficas:</strong> cc, sc, xc, mp, mb, nv, nf, nm
      </div>
      <br>
      
      <!-- Acentos obligatorios -->
      <div style="margin-top: 10px; margin-bottom: 10px; padding: 10px; background: #f5f5f5; border-radius: 6px;">
        <label style="display: flex; align-items: center; gap: 8px; font-size: 14px;">
          <input id="tutorAcentosObligatorios" type="checkbox" style="margin: 0;" tabindex="3">
          <span>Acentos obligatorios (m√°s dif√≠cil)</span>
        </label>
        <div style="font-size: 12px; color: #666; margin-top: 4px;">
          B√°sico: desactivado ¬∑ Intermedio/Avanzado: opcional ¬∑ Experto: siempre activado
        </div>
      </div>
      
      <!-- Modo estricto -->
      <div style="margin-top:10px; display:flex; align-items:center; gap:10px;">
        <label>
          <input id="tutorStrictMode" type="checkbox" checked tabindex="4"> Modo estricto (solo espa√±ol)
        </label>
      </div>
    </div>
    
    <p>Selecciona un nivel de dificultad:</p>
    
    <div class="actions" style="margin-top: 6px;">
      <button class="btn-ghost" onclick="goToPage('page-tutor-info')">‚óÇ Volver</button>
      <button id="tutorNivelBasico" onclick="configurarEjercicioTutor('basico')">üå± Nivel B√°sico</button>
      <button id="tutorNivelIntermedio" onclick="configurarEjercicioTutor('intermedio')">üåø Nivel Intermedio</button>
      <button id="tutorNivelAvanzado" onclick="configurarEjercicioTutor('avanzado')">üå≥ Nivel Avanzado</button>
      <button id="tutorNivelExperto" onclick="configurarEjercicioTutor('experto')">üî• Nivel Experto</button>
      <button class="btn-ghost" type="button" onclick="refrescarDatosRAE()" title="Limpiar cach√© del JSON y recargar">‚Üª Refrescar datos</button>
    </div>
  </section>

  <!-- P√°gina 2.6: Panel del Tutor (despu√©s de configurar) -->
  <section id="page-tutor" class="page">
    <div class="card">
      <h3>üéì Panel del Tutor</h3>
      
      <!-- Resumen de configuraci√≥n -->
      <div id="tutorConfigSummary" class="config-summary">
        <h4>‚öôÔ∏è Configuraci√≥n del Ejercicio</h4>
        <div id="configDetails"></div>
        <button class="btn-ghost" onclick="goToPage('page-tutor-config')" style="margin-top: 10px;">‚úèÔ∏è Modificar Configuraci√≥n</button>
      </div>
      
      <div id="tutorStatus" class="status-panel">
        <p>Iniciando servidor PeerJS...</p>
      </div>
      
      <div id="sessionInfo" style="display: none;">
        <div class="session-card">
          <h4>üì° Informaci√≥n de la Sesi√≥n</h4>
          <div class="session-details">
            <p><strong>ID de Sesi√≥n:</strong> <span id="sessionId" class="session-id">-</span></p>
            <p><strong>Estado:</strong> <span id="serverStatus">Conectando...</span></p>
          </div>
        </div>
        <div class="tutor-controls" style="margin-bottom:12px; display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:center;">
          <button id="startExercise" onclick="startGroupExercise()" disabled>‚ñ∂Ô∏è Iniciar Ejercicio</button>
          <button id="tutorStopAll" class="btn-ghost" onclick="tutorToggleLockAll()">‚õî Bloquear pantallas</button>
          <button id="tutorNewExercise" class="btn-ghost" onclick="tutorNewExercise()">üÜï Nuevo ejercicio</button>
          <button id="tutorNewSession" class="btn-ghost" onclick="tutorNewSession()">üîÑ Nueva Sesi√≥n</button>
          <button id="stopSession" onclick="stopSession()" class="btn-ghost">‚èπÔ∏è Terminar Sesi√≥n</button>
        </div>
        <!-- Controles de reproducci√≥n del tutor (arriba de participantes) -->
        <div id="tutorPlayback" class="tutor-controls" style="margin: 8px 0 12px; display: none; gap: 6px; flex-direction: column; width:100%;">
          <!-- Fila superior: Mostrar palabra + Palabra actual -->
          <div class="row-top" style="display:flex; flex-direction:column; gap:8px; width:100%;">
            <div style="display:flex; align-items:center; gap:10px;">
              <label class="inline" style="display:flex; align-items:center; gap:6px;">
                <input type="checkbox" id="showCurrentWord" onchange="refreshTutorCurrentWordLabel()"> Mostrar palabra
              </label>
              <strong>Palabra actual:</strong> <span id="tutorCurrentWord">‚Äî</span>
            </div>
            <div style="display:flex; align-items:center; gap:10px;">
              <label class="inline" style="display:flex; align-items:center; gap:6px;">
                <input type="checkbox" id="participantAudio"> Reproducir audio en participantes
              </label>
              <span class="hint" style="font-size:12px; color:#666;">Por defecto desactivado</span>
            </div>
            <!-- Barra de progreso larga (misma que participantes) con contador a la derecha -->
            <div class="progress-row" style="display:flex; align-items:center; gap:8px; width:100%;">
              <div class="progress" style="height:8px; background:#eee; border-radius:6px; overflow:hidden; flex:1;">
                <div id="tutorOverallProgressFill" style="height:100%; width:0%; background: linear-gradient(90deg, #4CAF50, #81C784);"></div>
              </div>
              <span id="tutorOverallProgressText" class="hint">0/0</span>
            </div>
          </div>
          <!-- Fila inferior: Progreso/Resp a la izquierda y botones a la derecha -->
          <div class="row-bottom" style="display:flex; align-items:center; gap:10px; width:100%;">
            <div class="left" style="display:flex; align-items:center; gap:10px;"></div>
            <div class="actions" style="display:flex; gap:8px; flex-wrap: wrap; margin-left:auto; align-items:center;">
              <button id="tutorPlayWord" onclick="tutorPlayCurrentWord()">‚ñ∂Ô∏è Reproducir</button>
              <button id="tutorNextWord" onclick="nextWordInExercise()">Siguiente ‚ñ∂</button>
              <label class="inline" style="display:flex; align-items:center; gap:6px;">
                <input type="checkbox" id="autoAdvance"> Auto
              </label>
              <select id="autoDelay" style="min-width: 80px;">
                <option value="1500">1.5 s</option>
                <option value="2000" selected>2 s</option>
                <option value="3000">3 s</option>
                <option value="4000">4 s</option>
                <option value="5000">5 s</option>
              </select>
              <span class="hint" id="tutorResponses" style="margin-left:8px;">Resp: 0/0</span>
            </div>
          </div>
        </div>

        <div class="participants-panel">
          <h4>üë• Participantes Conectados (<span id="participantCount">0</span>)</h4>
          <div id="participantsList" class="participants-list">
            <p class="no-participants">No hay participantes conectados</p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="actions">
      <button class="btn-ghost" onclick="goToPage('page-tutor-config')">‚óÇ Configuraci√≥n</button>
    </div>
  </section>

  <!-- P√°gina 2.6: Interfaz del Participante -->
  <section id="page-participant" class="page">
    <div class="card">
      <h3>üìù Panel del Participante</h3>
      
      <div id="participantConnection" class="connection-panel">
        <div class="form-field">
          <label for="participantName"><strong>Tu Nombre:</strong></label>
          <input id="participantName" type="text" placeholder="Ingresa tu nombre y apellido" tabindex="1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
        </div>
        <div class="form-field">
          <label for="sessionIdInput" style="display:block; margin-bottom: 6px;"><strong>ID de Sesi√≥n del Tutor (MAY√öSCULAS):</strong></label>
          <input id="sessionIdInput" type="text" placeholder="Ingresa el ID de sesi√≥n" style="text-align: center; font-family: monospace; text-transform: uppercase; margin-top: 6px; margin-bottom: 12px;" tabindex="2" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
          <div class="hint" style="font-size: 12px; color: #b91c1c; margin-top: 12px; text-align:center; font-weight: 600;">
            ‚ö†Ô∏è Importante: el ID <strong>distingue may√∫sculas</strong>. Escr√≠belo en <strong>MAY√öSCULAS</strong> (ej.: <code>TUTOR_AB12CD</code>).
          </div>
        </div>
        <button id="connectToSession" onclick="connectToSession()" tabindex="3">üîó Conectar a Sesi√≥n</button>
      </div>
      
      <div id="participantStatus" class="status-panel" style="display: none;">
        <p id="connectionStatus">Conectando...</p>
      </div>
      
      <div id="participantExercise" class="exercise-panel" style="display: none;">
        <div class="participant-info">
          <p><strong>Alumno:</strong> <span id="participantDisplayName">-</span></p>
          <p><strong>Conectado a:</strong> <span id="connectedSession">-</span></p>
          <p><strong>Estado:</strong> <span id="exerciseStatus">Esperando...</span></p>
        </div>
        
        <div id="participantGame" style="display: none;">
          <!-- Progreso del participante (arriba del cuadro de texto) -->
          <div class="participant-progress" style="margin-top: 16px;">
            <div class="progress" aria-label="Progreso de palabras">
              <div id="participantProgressFill" class="progress-fill" style="width:0%"></div>
            </div>
            <div id="participantProgressText" class="progress-text">0/0</div>
          </div>

          <div class="participant-input">
            <input type="text" id="participantAnswer" placeholder="Escribe la palabra aqu√≠" 
                   autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" 
                   data-gramm="false" onkeydown="handleParticipantEnter(event)">
            <button onclick="submitParticipantAnswer()">‚úì Confirmar</button>
          </div>
          
          <div id="participantFeedback" class="participant-feedback"></div>
        </div>
        
        <!-- Reporte del participante (despu√©s del ejercicio) -->
        <div id="participantReport" style="display: none;">
          <h4>üìä Tu Reporte</h4>
          <div class="actions" style="margin: 12px 0;">
            <button onclick="generarReportePDF()">‚¨áÔ∏è Descargar PDF</button>
            <button onclick="generarPracticaManual()">üìù Pr√°ctica Manual</button>
          </div>
          <div id="participantReportContent"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- P√°gina 3: Reporte final -->
  <section id="page-report" class="page">
    <div class="actions" style="margin-top: 6px;">
      <button class="btn-ghost" onclick="goToPage('page-config')">‚óÇ Nueva Sesi√≥n</button>
      <button class="btn-ghost" onclick="irAlEjercicio()">Nuevo ejercicio</button>
      <button onclick="generarReportePDF()">‚¨áÔ∏è Reporte PDF</button>
      <button onclick="generarPracticaManual()">üìù Pr√°ctica Manual</button>
    </div>
    <div class="card" style="margin-top: 14px;">
      <div id="reporteFinal" class="status"></div>
    </div>
  </section>

  <!-- Librer√≠as para generar PDF en el navegador -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.0/dist/jspdf.plugin.autotable.min.js"></script>
  <!-- PeerJS para comunicaci√≥n P2P -->
  <script src="https://unpkg.com/peerjs@1.5.0/dist/peerjs.min.js"></script>
  <!-- Simple Keyboard (solo se inicializa en m√≥viles/tablets) -->
  <script src="https://cdn.jsdelivr.net/npm/simple-keyboard@latest/build/index.js"></script>
  <!-- M√≥dulos del sistema: (se cargan m√°s abajo con onload/onerror y logs) -->
  
  <!-- Modal personalizado para confirmaci√≥n de descarga -->
  <div id="downloadModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle">‚úÖ Descarga Completada</h3>
        <span class="modal-close" onclick="closeDownloadModal()">&times;</span>
      </div>
      <div class="modal-body">
        <p id="modalMessage">Archivo descargado exitosamente</p>
        <div class="modal-actions">
          <button id="openFileBtn" class="btn-primary" onclick="openDownloadedFile()">üìÇ Abrir Archivo</button>
          <button class="btn-ghost" onclick="closeDownloadModal()">Cancelar</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Contenedor inline para Teclado Virtual (solo m√≥viles/tablets) -->
  <div id="vk-inline" class="vk-inline-container" style="display:none;" aria-hidden="true">
    <div class="simple-keyboard"></div>
  </div>

  </div>
  
  <!-- Pie de p√°gina -->
  <footer>
    <div style="width: 100%; max-width: 980px; margin: 0 auto; text-align: center; padding: 8px 0 4px;">
      <p style="margin: 0; font-size: 12px; color: #334155; line-height: 1.4;">
        <strong>¬© 2025 GMR - Todos los derechos reservados</strong> ¬∑ 
        <span style="font-size: 11px; color: #64748b;">C√≥digo propietario. Prohibida su modificaci√≥n o redistribuci√≥n.</span>
      </p>
      <p style="margin: 2px 0 0; font-size: 11px; line-height: 1.3;">
        <a href="assets/politicas-privacidad.html" style="color: #0ea5e9; text-decoration: none; margin: 0 4px;">Pol√≠ticas de Privacidad</a> |
        <a href="LICENSE.md" style="color: #0ea5e9; text-decoration: none; margin: 0 4px;">Licencia</a> |
        <a href="mailto:hgomero@gmail.com" style="color: #0ea5e9; text-decoration: none; margin: 0 4px;">Contacto</a>
      </p>
    </div>
  </footer>
  
  
  
  <!-- Scripts principales -->
  <!-- Device Detector debe cargarse primero -->
  <script src="modules/device-detector.js" onload="console.log('‚úÖ modules/device-detector.js cargado')" onerror="console.error('‚ùå Error cargando modules/device-detector.js')"></script>
  <script src="modules/virtual-keyboard.js" onload="console.log('‚úÖ modules/virtual-keyboard.js cargado')" onerror="console.error('‚ùå Error cargando modules/virtual-keyboard.js')"></script>
  <script src="modules/cache.js" onload="console.log('‚úÖ modules/cache.js cargado')" onerror="console.error('‚ùå Error cargando modules/cache.js')"></script>
  <script src="modules/navigation.js" onload="console.log('‚úÖ modules/navigation.js cargado')" onerror="console.error('‚ùå Error cargando modules/navigation.js')"></script>
  <script src="modules/voice-strategy.js" onload="console.log('‚úÖ modules/voice-strategy.js cargado')" onerror="console.error('‚ùå Error cargando modules/voice-strategy.js')"></script>
  <script src="modules/tts.js" onload="console.log('‚úÖ modules/tts.js cargado')" onerror="console.error('‚ùå Error cargando modules/tts.js')"></script>
  <!-- Definir ruta del JSON antes del cargador de datos -->
  <script>
    window.CONFIG = window.CONFIG || {};
    window.CONFIG.RAE_WORD_LIST_URL = './assets/palabras-con-frecuencia.json';
    // Definir claves de cach√© antes de cargar DataLoader (evita clave 'undefined')
    window.CONFIG.RAE_CACHE_KEY = 'rae_words_oficial_cache_v1';
    window.CONFIG.RAE_CACHE_TTL_MS = 30 * 24 * 60 * 60 * 1000; // 30 d√≠as
    // Activar modo DEBUG para mostrar diagn√≥sticos (e.g., conteo por niveles)
    window.DEBUG = true;
    // Producci√≥n: permitir m√∫ltiples sesiones simult√°neas con IDs √∫nicos
    // Si necesitas modo desarrollo con ID fijo, cambia a true temporalmente
    window.CONFIG.DEV_DISABLE_SESSION_ID = false;
    window.CONFIG.DEV_FIXED_TUTOR_ID = 'TUTOR_DEV';
  </script>
  <!-- Eliminado: diccionario externo; validaci√≥n se hace localmente -->
  <script src="modules/data-loader.js?v=dbg1" onload="console.log('‚úÖ modules/data-loader.js cargado')" onerror="console.error('‚ùå Error cargando modules/data-loader.js')"></script>
  <script src="modules/dev-utils.js" onload="console.log('‚úÖ modules/dev-utils.js cargado')" onerror="console.error('‚ùå Error cargando modules/dev-utils.js')"></script>
  <script src="modules/group-state.js" onload="console.log('‚úÖ modules/group-state.js cargado')" onerror="console.error('‚ùå Error cargando modules/group-state.js')"></script>
  <script src="modules/peer-manager.js" onload="console.log('‚úÖ modules/peer-manager.js cargado')" onerror="console.error('‚ùå Error cargando modules/peer-manager.js')"></script>
  <script src="modules/game-state.js" onload="console.log('‚úÖ modules/game-state.js cargado')" onerror="console.error('‚ùå Error cargando modules/game-state.js')"></script>
  <script src="modules/reportes.js" onload="console.log('‚úÖ modules/reportes.js cargado')" onerror="console.error('‚ùå Error cargando modules/reportes.js')"></script>
  <script src="modules/ui.js" onload="console.log('‚úÖ modules/ui.js cargado')" onerror="console.error('‚ùå Error cargando modules/ui.js')"></script>
  <script src="modules/params.js" onload="console.log('‚úÖ modules/params.js cargado')" onerror="console.error('‚ùå Error cargando modules/params.js')"></script>
  <script src="modules/error-bank.js" onload="console.log('‚úÖ modules/error-bank.js cargado')" onerror="console.error('‚ùå Error cargando modules/error-bank.js')"></script>
  <script src="modules/validation.js" onload="console.log('‚úÖ modules/validation.js cargado')" onerror="console.error('‚ùå Error cargando modules/validation.js')"></script>
  <script src="modules/router.js" onload="console.log('‚úÖ modules/router.js cargado')" onerror="console.error('‚ùå Error cargando modules/router.js')"></script>
  <script src="modules/game-flow.js" onload="console.log('‚úÖ modules/game-flow.js cargado')" onerror="console.error('‚ùå Error cargando modules/game-flow.js')"></script>
  <!-- Debe cargarse antes de app.js para que los wrappers deleguen correctamente -->
  <script src="modules/individual-mode.js?v=dbg1" onload="console.log('‚úÖ modules/individual-mode.js cargado')" onerror="console.error('‚ùå Error cargando modules/individual-mode.js')"></script>
  <!-- M√≥dulos del modo grupal -->
  <script src="modules/participant-helpers.js" onload="console.log('‚úÖ modules/participant-helpers.js cargado')" onerror="console.error('‚ùå Error cargando modules/participant-helpers.js')"></script>
  <script src="modules/group-mode-tutor.js" onload="console.log('‚úÖ modules/group-mode-tutor.js cargado')" onerror="console.error('‚ùå Error cargando modules/group-mode-tutor.js')"></script>
  <script src="assets/app.js?v=refactor1" onload="console.log('‚úÖ app.js cargado (refactor1)')" onerror="console.error('‚ùå Error cargando app.js')"></script>
  
  <!-- Eliminado: script de diagn√≥stico duplicado -->
  
  <!-- Inicializador del teclado virtual (solo m√≥viles/tablets) -->
  <script>
    (function(){
      function initVK(){
        try {
          if (window.initVirtualKeyboardIfNeeded) {
            window.initVirtualKeyboardIfNeeded();
          }
        } catch (e) {
          console.warn('[VK] No se pudo inicializar el teclado virtual:', e);
        }
      }
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initVK);
      } else {
        initVK();
      }
    })();
  </script>
</body>
</html>
